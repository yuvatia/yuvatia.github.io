export const frontmatter = {
    title: 'Projective Cameras',
    date: '2024-04-24'
};

While we percieve the world in 3D, the image of the world created on our retina is actually 2D: incoming light rays from the world are refracted by the lens of the eye and focused on the retina to form a two-dimensional image. Cameras work in a similar way - incoming light rays are focused by the lens of the camera onto the film or sensor to form a two-dimensional image, with the film or sensor serving the same function as our retina. The process of capturing a 3D world onto a 2D image is called **3D projection**. Since the image is a result of light hitting some projective plane - be it film, sensor or retina - it is important to have a mathematical model of how light propgates in space. This model then gives rise to camera models, which describe the relation between the 3D world and the 2D image.

## Geometrical Optics

The simplest model of light propagation is the **ray model**, which is the basis of geometrical optics. In this model, light is represented as rays which obey the following rules (taken from Wikipedia, slightly rephrased):

1. Rays travel in straight-line in a homogenous medium.
2. Rays are reflected or refracted at the interface between two dissimilar media.
3. Rays may be absorbed by the medium.
4. Rays follow curved paths in a medium in which the refractive index changes.

This model, while being very simple, can be used to describe a vast amount of optical phenomena, as we will see in the next section.

## Pinhole Camera Model

Consider a closed box with a small hole on one side, and a screen on the opposite side. Since the box is closed, light may only enter the box through the hole. Now, assume that the hole is so small that it can be approximated as a point $O$. Consider some point $A$ in the outside world, in the halfplane behind the hole. For a light ray starting from $A$ to enter the box, it needs to pass through the hole. Since the hole is approximated as a point, and since light travels in straight lines under the assumption of our model, we know that only one light ray from $A$ may enter the box. This light ray will then hit the screen at some point $A'$, which we call the *image* of $A$. The following illustration shows this setup:

<div align="center">![Pinhole Camera](https://upload.wikimedia.org/wikipedia/commons/3/3b/Pinhole-camera.svg)</div>

An important observation is that, for any point $P$ along the segment $AO$, the image of $P$ will be $A'$, since the light ray from $P$ also enters the box through the same line $AO$ which hits the projective plane at $A'$. This means that the image of a point in 3 dimensional space on the projective plane is independent of the distance of the point from the origin.

We can relate $A$ and $A'$ using similar triangles. Let $A = (X, Y, Z)$ and $A' = (X', Y', Z')$. Let the box be axis-aligned and sitted on the $z$ axis, and let $O$ be the origin. Let the position $z$ direction be towards the world (meaning that the projective plane has a negative $z$ value). Then we know that the projective plane's $z$ component is constant and equals some value $-f$ (for focal distance). Then, the following equations hold:

$$
\frac{X'}{-f} = \frac{X}{Z} \quad \text{and} \quad \frac{Y'}{-f} = \frac{Y}{Z}
$$

Alternatively, we can write:

$$
A':\quad \begin{pmatrix} -f \frac{X}{Z}& -f \frac{Y}{Z}& -f \end{pmatrix}
$$

This means that the image is **inverted**, as illustrated above.

This also means that objects further away from box will appear smaller on the projective plane. This phenomena is known as *perspective*, and helps us perceive depth.

Let's consider the case of two parallel lines, parametrized as:

$$
\begin{gathered}
l_{1}: a_{1} + \vec{v}t \\
l_{2}: a_{2} + \vec{v}t
\end{gathered}
$$

Consider the projected image of some point along the line as a function of $t$. Using our previous equation, we get:

$$
\begin{gathered}
A'_{i}: \quad 
\begin{pmatrix} 
-f \frac{a_{i,x}+v_{x}t}{a_{i,z}+v_{z}t} & 
-f \frac{a_{i,y}+v_{y}t}{a_{i,z}+v_{z}t} &
-f
\end{pmatrix}
\end{gathered}
$$

Which, assuming $t \ne 0$, can be rearranged as:

$$
A'_{i}: \quad
\begin{pmatrix}
-f \frac{\frac{a_{i,x}}{t}+v_{x}}{\frac{a_{i,z}}{t}+v_{z}} &
-f \frac{\frac{a_{i,y}}{t}+v_{y}}{\frac{a_{i,z}}{t}+v_{z}} &
&
-f
\end{pmatrix}
$$

Let's see what happens when $t \to \infty$:

$$
A'_{i}: \quad
\begin{pmatrix}
-f \frac{v_{x}}{v_{z}}&
-f \frac{v_{y}}{v_{z}}&
-f
\end{pmatrix}
$$

Note that this result is independent of the origin of the line $a_{i}$, but rather only depends on the direction of the line, meaning that in the projective plane, parallel lines intersect "at infinity". We call the point where parallel lines intersect the "vanishing point". Also note how the projected lines still remain straight in the sense that they are still linear lines in the projective plane, this can be easily proven by looking at the equation for $A'_{i}$ and seeing that it can be written as a line eqaution:

$$
l'_{i}: \quad a'_{i} + \vec{v}'t
$$

This means that lines in the projective plane remain lines and locally parallel, but parallel lines seem to get closer and closer together the further they are from the origin. The following image illustrates this:

<div align="center"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Railroad-Tracks-Perspective.jpg" alt="Vanishing point" width="300" height="400"/></div>

The box-with-a-tiny-hole setup we described is called a *camera obscura*, and is the first known camera model. The model described is called the *pinhole camera model*. While easy to reason about, it has one major shortcoming in photography - because the hole is extremely small, very little light enters the box, and the image formed is very dim. This can be accounted for by using materials which respond to light in an accumulative manner, such as film or digital sensors. We then need to *expose* the material to light for some duration of time to receive a better lit image. In photography, this is called *exposure*. While exposure does help, it does not solve the problem of capturing images in a poorly-lit environment. To solve this problem, we need to let more light in, which can be done by widening the hole. This, however, introduces a new problem - now, multiple light rays from the same point enter the box and hit the projective plane at different points, creating a blurry image, a phenomena known as *defocus*. To solve this problem, we need some way of focusing multiple light rays from the same source to the same point on the projective plane, so that we can maintain a sharp image. This is done using lenses - much like the ones we have in our eyes.

## A few words on lenses

When discussing camera lenses, we usually discuss thin lenses, which are lenses with a thickness negligible compared to their focal length, which lets us approximate the lens as a point, simplifying calculations and ray tracing. Generally speaking, we usually discuss two types of lenses - converging (or convex) lenses, that bring parallel rays closer together to form an image, or diverging (concave) lenses, that bring parellel rays further apart, forming a virtual image (much like the image created by a reflective surface such as a mirror). Here's an illustration of converging lenses taken from Wikipedia:

<div align="center">![Converign lenses](https://upload.wikimedia.org/wikipedia/commons/8/8f/Convex_lens_-_perfect.svg)</div>

Since we are about to move away from geometrical optics for the duration of this discussion, we will not delve into the mathematics of lenses. For completeness, we will mention that that lenses give rise to a new phenomena which we didn't have in the pinhole model - due to the geometry of the lens, only objects at one distance can be properly fully focused by the lens, leaving other objects defocused, forming a [circle of confusion](https://en.wikipedia.org/wiki/Circle_of_confusion). This phenomena is closely related to the [depth of field](https://en.wikipedia.org/wiki/Depth_of_field). This is how we percieve the world, so being able to model this phenomena is important if we wish to create more immersive visuals.

## Projective Plane

In the previous Selection, we've observed the following properties regarding the projective plane:

1. Parallel lines in real space intersect at a single point, called the vanishing point.
2. Lines remain lines in the projective plane. This means that the projective plane preserves the property of having exactly one line connecting two distinct points.

We can take these properties and use them to define a new geometric structure which we will fittingly name a [projective plane](https://en.wikipedia.org/wiki/Projective_plane). The proper definition of a projective plane is a bit more involved, as is as follows (taken from Wikipedia):

A projective plane consits of a set of lines, points and a relation between points and lines called incidence, such that:
1. For any two distinct points there is exactly one line incident with both of them.
2. For any two distinct lines there is exactly one point incident with both of them.
3. There are four points such that no line is incident with more than two of them.

Let's unpack this definition. It may seem a bit odd to use the term "incidence" to define the relation instead of just saying that "the points are on the line" or "the line passes through the point". The reason for this is that the term is meant to ephasize the duality between lines and points, which we will expand upon here.

Now let's unpack each condition. The first condition simply states that there is exactly one line connecting two points. The Eucledian plane also has this condition. The second condition states that there are no globally parallel lines, which we have seen in the previous section.

The third and final condition is used to exclude degenerate cases, which abide by the first two conditions but are not interesting. Consider, for example, the case where we have both sets be the empty set, or have only one point but no lines, or one line but no points. Clearly these cases meet the first two conditions, but are not interesting enough to merit a discussion. 

Armed with this definition, let's attempt to formally construct the projective plane we've been discussing in the previous sections.

## Real Projective Plane

Consider the Euclidean (real) plane $\mathbb{R}^{2}$. The first and third conditions are already satisfied simply by choosing the Euclidean plane. For every slope (more formally, for every parallel class of lines) we associate a new point incident with all lines having this slope. We call these points *points at infinity*. We've now satisfied the second condition for all lines in $\mathbb{R}^{2}$, but by expanding the set of points with all the points at infinity, we have violated the first condition: consider two points at infinity - there isn't a line incident with both. To satisfy the condition, we introduce a line at infinity, which is incident with all points at infinity (and only those points), thus satisfying all conditions. We call this the *real projective plane* or *extended Euclidean plane*, and denote it as $\mathbb{RP}^{2}$ or $PG(2, \mathbb{R})$.

Equivalently, we can construct the real projective plane using a vector space, which also makes the algebraic representation of the plane more obvious. Consider the vector space $\mathbb{R^{n}}$. We can identify points with vectors $x$ and lines with two vectors $x, y$ (obviously not the same $x$). Now, consider the subspace:

$$
W_{x} = \{kx : k \in \mathbb{R}\}
$$

Clearly, it is a 1-dimensional vector space, making it the minimal subspace containing $x$. Its elements are simply the point $x$ written as a vector scaled by some scalar. Geometrically we can think of it as an affine combination of the origin and $x$, or more simply as all points on the line connecting $x$ to the origin. Let's denote this relationship as an equivalance class:

$$
\forall k \in \mathbb{R}: x \sim kx 
$$

This means that if $n=2$, then $(x_{1}, x_{2})$ is equivalent to, for example, $(2x_{1}, 2x_{2})$. We can define a system of coordinates using this relation, which we call [homogenous coordinates](https://en.wikipedia.org/wiki/Homogeneous_coordinates).

Now, consider two linearly independent vectors in $\mathbb{R}^{n}$, $x, y$. Since they are linearly independent, we know that $W_{x}$ and $W_{y}$ are distinct subspaces. Consider the set of linear combination of the two:

$$
U_{x, y} = \{ax + by : a, b \in \mathbb{R}\}
$$

Since they are independent, we know that $ax+by=0$ iff $a=0$ and $b=0$, so assuming a vector $u \in U, u \ne 0$, and w.l.o.g, we can assume that $b \ne 0$, and write the set as:

$$
U_{x, y} = \{\frac{a}{b}x + y : a,b \in \mathbb{R}, 0\}
$$

This is a subspace of $\mathbb{R}^{n}$ of $\text{dim}=2$. Geometrically, this is a plane of all the vectors which pass through the origin. Consider the subset of $U$ such that the ratio of $a$ and $b$ remains constant. Clearly this subset is a linear subspace of $U$ of $\text{dim}=1$, and it represents a line in $\mathbb{R}^{n}$, so let's denote it as $L$, and denote $\frac{a}{b}$ as $m$.

$$
L = \{mx+y : t \in \mathbb{R}\} 
$$

$$
\begin{gathered}
mx + y = 0 \\
mx = -y \\
\end{gathered}
$$


Construct vector space

Projective Spaces

## Homogenous Coordinates and linearity
import { FaTemperatureThreeQuarters } from "react-icons/fa6"
